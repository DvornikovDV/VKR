# CHANGELOG - Widgets Phase 1

## [Unreleased] - 2026-01-24

### Добавлено

#### Базовая инфраструктура виджетов

**widget-manager.js** (~350 строк)
- `Widget` - базовый класс для всех виджетов
- `DisplayWidget` - класс для read-only виджетов
- `WidgetManager` - управление жизненным циклом виджетов
  - Создание/удаление виджетов
  - Граничные проверки при перемещении
  - Синхронизация с изображениями (move/resize/delete)
  - Drag & drop с ограничениями

**widget-types.js** (~340 строк)
- `WIDGET_DEFAULTS` - константы по умолчанию для каждого типа
- 4 Display типа виджетов:
  - `NumberDisplayWidget` - числовой дисплей (число + единица)
  - `TextDisplayWidget` - текстовый дисплей (статус/label)
  - `LedWidget` - светодиод (on/off индикатор)
  - `GaugeWidget` - манометр (стрелочный индикатор)
- `createWidget()` - фабрика для создания виджетов
- Konva.js рендеринг для всех типов

**context-menu.js** (~180 строк)
- `ContextMenu` - контекстное меню для правого клика
- Поддержка submenu
- Автоматическое позиционирование
- Закрытие при клике вне меню или Escape

**styles.css**
- Стили для `.context-menu`
- Стили для `.context-submenu`
- Hover эффекты
- Responsive позиционирование

### Ключевые функции

#### Граничные проверки
- Виджеты не могут выйти за границы изображения
- Проверки по всем 4 сторонам (лево, право, верх, низ)

#### Синхронизация с изображениями
- `onImageMove()` - виджеты двигаются вместе с изображением
- `onImageResize()` - виджеты масштабируются по относительным координатам
- `onImageDelete()` - виджеты удаляются вместе с изображением

#### Относительные координаты
- `relativeX` и `relativeY` - позиция виджета относительно изображения
- Автоматическое пересчёт при ресайзе

### Технические детали

#### Konva.js рендеринг
- Все виджеты рисуются как `Konva.Group`
- Поддержка `batchDraw()` для оптимизации
- Автоматическое удаление старых групп при перерисовке

#### Визуальные особенности
- NumberDisplay: фон + текст с единицей
- TextDisplay: фон + текст (left-aligned)
- LED: круг + glow эффект при ON
- Gauge: циферблат + стрелка + метки min/max

### Следующие шаги

**Следующий коммит** (День 2-3):
- [ ] Обновить `image-manager.js` - добавить контекстное меню
- [ ] Обновить `properties-panel.js` - расширить для виджетов
- [ ] Обновить `selection-manager.js` - поддержка выбора виджетов
- [ ] Обновить `ui-controller.js` - интеграция WidgetManager

**Тестирование** (День 4):
- [ ] Создание всех 4 типов
- [ ] Граничные проверки
- [ ] Синхронизация с изображениями
- [ ] Панель свойств

### Статистика

**Строк кода**: ~870 строк
**Файлов создано**: 3 (новые) + 1 (обновлён)
**Коммитов**: 4
**Время**: День 1 (часть 1)

---

## Прогресс по Plan.md

### Этап 1: WidgetManager класс ✅
- [x] Базовый класс Widget
- [x] Класс DisplayWidget
- [x] Граничные проверки
- [x] Синхронизация с изображениями
- [x] Drag handlers

### Этап 2: widget-types.js - 4 Display типа ✅
- [x] WIDGET_DEFAULTS
- [x] NumberDisplayWidget + render()
- [x] TextDisplayWidget + render()
- [x] LedWidget + render()
- [x] GaugeWidget + render()
- [x] Фабрика createWidget()

### Этап 3: Контекстное меню ✅
- [x] Класс ContextMenu
- [x] Поддержка submenu
- [x] Стили CSS
- [ ] Интеграция в image-manager.js (следующий шаг)

### Этап 4: Панель свойств ⏳
- [ ] Расширить PropertiesPanel
- [ ] Type-specific параметры
- [ ] Редактирование параметров

### Этап 5: SelectionManager ⏳
- [ ] Поддержка виджетов
- [ ] Визуальное выделение

### Этап 6: UIController интеграция ⏳
- [ ] Инициализация WidgetManager
- [ ] Инициализация ContextMenu
- [ ] Callbacks для синхронизации

### Этап 7: Тестирование ⏳
- [ ] Функциональные тесты
- [ ] Граничные проверки
- [ ] Синхронизацию
- [ ] Визуальное качество
