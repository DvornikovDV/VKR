# Видение механики управления системой через виджеты

**Дата**: 29.01.2026  
**Версия**: 1.0  
**Статус**: Design Document  

---

## Обзор

Этот документ описывает полный цикл управления инженерными системами через интерактивные виджеты на Dashboard'е: от конфигурации элемента схемы до отправки команды в реальное устройство и отображения статуса.

---

## Часть 1: Твоё понимание мониторинга (ВЕРНО)

Ты совершенно прав. Цепочка мониторинга данных датчиков:

```
Датчик температуры         Edge сервер              Центральный сервер        Dashboard
в отопительной системе        (Raspberry Pi)           (Node.js)               (Браузер)
         ↓                         ↓                        ↓                      ↓
    Modbus TCP              Получение данных        Сохранение в памяти    Отображение
   (230V, 45°C)      →      и сохранение        →   + распределение      →  значения в
                            на краю сети           через Socket.IO           поле датчика
                                                      в реальном времени
```

### Детально по этапам мониторинга:

**1. Датчик на Edge-сервере (Raspberry Pi)**
```
- Датчик DS18B20 или похожий подключен к GPIO
- Периодически читает значение температуры
- Отправляет в Modbus TCP сервер на том же Pi
  или сам публикует в MQTT брокер
```

**Итог этапа мониторинга**: Данные льются от датчика → Edge → Cloud → Dashboard в реальном времени (~100-500ms задержка).

---

## Часть 2: Механика управления (КОМАНДЫ)

Теперь ты хочешь понять, как работают команды (выключить помпу, открыть клапан, etc.). Это обратный поток.

### Сценарий: Оператор выключает помпу

**Визуально на Dashboard'е:**
```
Оператор видит переключатель (toggle switch). Нажимает его → выключает помпу.
```

---

## Часть 3: Полный цикл управления (от UI к устройству)

Это ПОЛНАЯ цепочка команды от клика до изменения состояния реального устройства:

### Этап 0: Предустановка конфигурации (в редакторе)

Перед тем как оператор что-то может делать, инженер должен всё настроить.

### Этап 1: Оператор нажимает переключатель на Dashboard'е

Оператор видит переключатель (toggle switch). Нажимает его → выключает помпу.

### Этапы 2-12: Полный цикл управления

См. подробное описание в файлах кода выше.

---

## Итоговая схема управления

Полный цикл управления:

1. **Конфигурация** (редактор) - инженер связывает UI элемент с тегом устройства
2. **Инициирование** (Dashboard) - оператор кликает переключатель
3. **Формирование команды** - создаётся объект с tagId, value, commandId
4. **Передача на сервер** - Socket.IO отправляет команду
5. **Валидация** - сервер проверяет авторизацию и конфигурацию
6. **Отправка на Edge** - MQTT публикация в topic команды
7. **Выполнение** - Edge-сервер выполняет реальное действие (GPIO/Modbus/HTTP)
8. **Подтверждение** - Edge отправляет ack с результатом
9. **Обновление кэша** - сервер обновляет tagCache
10. **Трансляция** - сервер отправляет обновление всем Dashboard'ам
11. **Отображение** - Dashboard обновляет UI элемент и индикатор
12. **Синхронизация** - всё синхронизировано: UI ↔ Server ↔ Device

**Время отклика**: ~500-1000ms (для хорошего UX)

**Надёжность**: Подтверждения, таймауты, логирование, откат при ошибке

**Масштабируемость**: Один оператор может управлять 100+ устройств через интерактивные элементы на одном Dashboard'е!

---

## Заключение

Полнофункциональная система управления через виджеты готова к реализации на основе текущей архитектуры SCADA.
